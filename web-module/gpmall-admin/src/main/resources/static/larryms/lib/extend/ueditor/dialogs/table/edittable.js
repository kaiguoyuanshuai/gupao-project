(function(){var r=$G("J_title"),l=$G("J_titleCol"),a=$G("J_caption"),i=$G("J_sorttable"),d=$G("J_autoSizeContent"),c=$G("J_autoSizePage"),m=$G("J_tone"),s,u=$G("J_preview");var e=function(){s=this;s.init()};e.prototype={init:function(){var e=new UE.ui.ColorPicker({editor:editor}),t=new UE.ui.Popup({editor:editor,content:e});r.checked=editor.queryCommandState("inserttitle")==-1;l.checked=editor.queryCommandState("inserttitlecol")==-1;a.checked=editor.queryCommandState("insertcaption")==-1;i.checked=editor.queryCommandState("enablesort")==1;var o=editor.queryCommandState("enablesort"),n=editor.queryCommandState("disablesort");i.checked=!!(o<0&&n>=0);i.disabled=!!(o<0&&n<0);i.title=o<0&&n<0?lang.errorMsg:"";s.createTable(r.checked,l.checked,a.checked);s.setAutoSize();s.setColor(s.getColor());domUtils.on(r,"click",s.titleHanler);domUtils.on(l,"click",s.titleColHanler);domUtils.on(a,"click",s.captionHanler);domUtils.on(i,"click",s.sorttableHanler);domUtils.on(d,"click",s.autoSizeContentHanler);domUtils.on(c,"click",s.autoSizePageHanler);domUtils.on(m,"click",function(){t.showAnchor(m)});domUtils.on(document,"mousedown",function(){t.hide()});e.addListener("pickcolor",function(){s.setColor(arguments[1]);t.hide()});e.addListener("picknocolor",function(){s.setColor("");t.hide()})},createTable:function(e,t,o){var n=[],a="<span>^</span>";n.push("<table id='J_example'>");if(o){n.push("<caption>"+lang.captionName+"</caption>")}if(e){n.push("<tr>");if(t){n.push("<th>"+lang.titleName+"</th>")}for(var i=0;i<5;i++){n.push("<th>"+lang.titleName+"</th>")}n.push("</tr>")}for(var r=0;r<6;r++){n.push("<tr>");if(t){n.push("<th>"+lang.titleName+"</th>")}for(var l=0;l<5;l++){n.push("<td>"+lang.cellsName+"</td>")}n.push("</tr>")}n.push("</table>");u.innerHTML=n.join("");this.updateSortSpan()},titleHanler:function(){var e=$G("J_example"),t=document.createDocumentFragment(),o=domUtils.getComputedStyle(domUtils.getElementsByTagName(e,"td")[0],"border-color"),n=e.rows[0].children.length;if(r.checked){e.insertRow(0);for(var a=0,i;a<n;a++){i=document.createElement("th");i.innerHTML=lang.titleName;t.appendChild(i)}e.rows[0].appendChild(t)}else{domUtils.remove(e.rows[0])}s.setColor(o);s.updateSortSpan()},titleColHanler:function(){var e=$G("J_example"),t=domUtils.getComputedStyle(domUtils.getElementsByTagName(e,"td")[0],"border-color"),o=e.rows,n=o.length;if(l.checked){for(var a=0,i;a<n;a++){i=document.createElement("th");i.innerHTML=lang.titleName;o[a].insertBefore(i,o[a].children[0])}}else{for(var a=0;a<n;a++){domUtils.remove(o[a].children[0])}}s.setColor(t);s.updateSortSpan()},captionHanler:function(){var e=$G("J_example");if(a.checked){var t=document.createElement("caption");t.innerHTML=lang.captionName;e.insertBefore(t,e.firstChild)}else{domUtils.remove(domUtils.getElementsByTagName(e,"caption")[0])}},sorttableHanler:function(){s.updateSortSpan()},autoSizeContentHanler:function(){var e=$G("J_example");e.removeAttribute("width")},autoSizePageHanler:function(){var e=$G("J_example");var t=e.getElementsByTagName(e,"td");utils.each(t,function(e){e.removeAttribute("width")});e.setAttribute("width","100%")},updateSortSpan:function(){var e=$G("J_example"),t=e.rows[0];var o=domUtils.getElementsByTagName(e,"span");utils.each(o,function(e){e.parentNode.removeChild(e)});if(i.checked){utils.each(t.cells,function(e,t){var o=document.createElement("span");o.innerHTML="^";e.appendChild(o)})}},getColor:function(){var e=editor.selection.getStart(),t,o=domUtils.findParentByTagName(e,["td","th","caption"],true);t=o&&domUtils.getComputedStyle(o,"border-color");if(!t)t="#DDDDDD";return t},setColor:function(t){var e=$G("J_example"),o=domUtils.getElementsByTagName(e,"td").concat(domUtils.getElementsByTagName(e,"th"),domUtils.getElementsByTagName(e,"caption"));m.value=t;utils.each(o,function(e){e.style.borderColor=t})},setAutoSize:function(){var e=this;c.checked=true;e.autoSizePageHanler()}};new e;dialog.onok=function(){editor.__hasEnterExecCommand=true;var e={title:"inserttitle deletetitle",titleCol:"inserttitlecol deletetitlecol",caption:"insertcaption deletecaption",sorttable:"enablesort disablesort"};editor.fireEvent("saveScene");for(var t in e){var o=e[t].split(" "),n=$G("J_"+t);if(n["checked"]){editor.queryCommandState(o[0])!=-1&&editor.execCommand(o[0])}else{editor.queryCommandState(o[1])!=-1&&editor.execCommand(o[1])}}editor.execCommand("edittable",m.value);d.checked?editor.execCommand("adaptbytext"):"";c.checked?editor.execCommand("adaptbywindow"):"";editor.fireEvent("saveScene");editor.__hasEnterExecCommand=false}})();