(function(d){function c(t,i,e){for(var o=4,a=[];o--;)a[o]=Math.round(i.rgba[o]+(t.rgba[o]-i.rgba[o])*(1-e));return"rgba("+a.join(",")+")"}var t=d.Axis,i=d.Chart,s=d.Point,e=d.Pointer,u=d.each,l=d.extend,h=d.merge,p=d.pick,m=d.numberFormat,o=d.getOptions(),f=d.seriesTypes,a=o.plotOptions,n=d.wrap,x=d.Color,r=function(){};o.mapNavigation={buttonOptions:{align:"right",verticalAlign:"bottom",x:0,width:18,height:18,style:{fontSize:"15px",fontWeight:"bold",textAlign:"center"}},buttons:{zoomIn:{onclick:function(){this.mapZoom(.5)},text:"+",y:-32},zoomOut:{onclick:function(){this.mapZoom(2)},text:"-",y:0}}};d.splitPath=function(t){var i,t=t.replace(/([A-Za-z])/g," $1 "),t=t.replace(/^\s*/,"").replace(/\s*$/,""),t=t.split(/[ ,]+/);for(i=0;i<t.length;i++)/[a-zA-Z]/.test(t[i])||(t[i]=parseFloat(t[i]));return t};d.maps={};n(t.prototype,"getSeriesExtremes",function(t){var e=this.isXAxis,o,a,n=[];u(this.series,function(t,i){if(t.useMapGeometry)n[i]=t.xData,t.xData=[]});t.call(this);o=p(this.dataMin,Number.MAX_VALUE);a=p(this.dataMax,Number.MIN_VALUE);u(this.series,function(t,i){if(t.useMapGeometry)o=Math.min(o,t[e?"minX":"minY"]),a=Math.max(a,t[e?"maxX":"maxY"]),t.xData=n[i]});this.dataMin=o;this.dataMax=a});n(t.prototype,"setAxisTranslation",function(t){var i=this.chart,e=i.plotWidth/i.plotHeight,o=this.isXAxis,a=i.xAxis[0];t.call(this);if(i.options.chart.type==="map"&&!o&&a.transA!==void 0)this.transA=a.transA=Math.min(this.transA,a.transA),t=(a.max-a.min)/(this.max-this.min),a=t>e?this:a,e=(a.max-a.min)*a.transA,a.minPixelPadding=(a.len-e)/2});n(i.prototype,"render",function(t){var i=this,e=i.options.mapNavigation;t.call(i);i.renderMapNavigation();e.zoomOnDoubleClick&&d.addEvent(i.container,"dblclick",function(t){i.pointer.onContainerDblClick(t)});e.zoomOnMouseWheel&&d.addEvent(i.container,document.onmousewheel===void 0?"DOMMouseScroll":"mousewheel",function(t){i.pointer.onContainerMouseWheel(t)})});l(e.prototype,{onContainerDblClick:function(t){var i=this.chart,t=this.normalize(t);i.isInsidePlot(t.chartX-i.plotLeft,t.chartY-i.plotTop)&&i.mapZoom(.5,i.xAxis[0].toValue(t.chartX),i.yAxis[0].toValue(t.chartY))},onContainerMouseWheel:function(t){var i=this.chart,e,t=this.normalize(t);e=t.detail||-(t.wheelDelta/120);i.isInsidePlot(t.chartX-i.plotLeft,t.chartY-i.plotTop)&&i.mapZoom(e>0?2:.5,i.xAxis[0].toValue(t.chartX),i.yAxis[0].toValue(t.chartY))}});n(e.prototype,"init",function(t,i,e){t.call(this,i,e);if(e.mapNavigation.enableTouchZoom)this.pinchX=this.pinchHor=this.pinchY=this.pinchVert=!0});l(i.prototype,{renderMapNavigation:function(){var t=this,i=this.options.mapNavigation,e=i.buttons,o,a,n,r=function(){this.handler.call(t)};if(i.enableButtons)for(o in e)if(e.hasOwnProperty(o))n=h(i.buttonOptions,e[o]),a=t.renderer.button(n.text,0,0,r).attr({width:n.width,height:n.height}).css(n.style).add(),a.handler=n.onclick,a.align(l(n,{width:a.width,height:a.height}),null,"spacingBox")},fitToBox:function(e,o){u([["x","width"],["y","height"]],function(t){var i=t[0],t=t[1];e[i]+e[t]>o[i]+o[t]&&(e[t]>o[t]?(e[t]=o[t],e[i]=o[i]):e[i]=o[i]+o[t]-e[t]);e[t]>o[t]&&(e[t]=o[t]);e[i]<o[i]&&(e[i]=o[i])});return e},mapZoom:function(t,i,e){if(!this.isMapZooming){var o=this,a=o.xAxis[0],n=a.max-a.min,r=p(i,a.min+n/2),i=n*t,n=o.yAxis[0],s=n.max-n.min,e=p(e,n.min+s/2);t*=s;r-=i/2;s=e-t/2;e=p(o.options.chart.animation,!0);i=o.fitToBox({x:r,y:s,width:i,height:t},{x:a.dataMin,y:n.dataMin,width:a.dataMax-a.dataMin,height:n.dataMax-n.dataMin});a.setExtremes(i.x,i.x+i.width,!1);n.setExtremes(i.y,i.y+i.height,!1);if(a=e?e.duration||500:0)o.isMapZooming=!0,setTimeout(function(){o.isMapZooming=!1},a);o.redraw()}}});a.map=h(a.scatter,{animation:!1,nullColor:"#F8F8F8",borderColor:"silver",borderWidth:1,marker:null,stickyTracking:!1,dataLabels:{verticalAlign:"middle"},turboThreshold:0,tooltip:{followPointer:!0,pointFormat:"{point.name}: {point.y}<br/>"},states:{normal:{animation:!0}}});t=d.extendClass(s,{applyOptions:function(t,i){var e=s.prototype.applyOptions.call(this,t,i);if(e.path&&typeof e.path==="string")e.path=e.options.path=d.splitPath(e.path);return e},onMouseOver:function(){clearTimeout(this.colorInterval);s.prototype.onMouseOver.call(this)},onMouseOut:function(){var e=this,o=+new Date,a=x(e.options.color),n=x(e.pointAttr.hover.fill),t=e.series.options.states.normal.animation,r=t&&(t.duration||500);if(r&&a.rgba.length===4&&n.rgba.length===4)delete e.pointAttr[""].fill,clearTimeout(e.colorInterval),e.colorInterval=setInterval(function(){var t=(new Date-o)/r,i=e.graphic;t>1&&(t=1);i&&i.attr("fill",c(n,a,t));t>=1&&clearTimeout(e.colorInterval)},13);s.prototype.onMouseOut.call(e)}});f.map=d.extendClass(f.scatter,{type:"map",pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color"},colorKey:"y",pointClass:t,trackerGroups:["group","markerGroup","dataLabelsGroup"],getSymbol:r,supportsDrilldown:!0,getExtremesFromAll:!0,useMapGeometry:!0,init:function(t){var i=this,e=t.options.legend.valueDecimals,o=[],a,n,r,s,l,h,p;h=t.options.legend.layout==="horizontal";d.Series.prototype.init.apply(this,arguments);l=i.options.colorRange;if(s=i.options.valueRanges)u(s,function(t){n=t.from;r=t.to;a="";n===void 0?a="< ":r===void 0&&(a="> ");n!==void 0&&(a+=m(n,e));n!==void 0&&r!==void 0&&(a+=" - ");r!==void 0&&(a+=m(r,e));o.push(d.extend({chart:i.chart,name:a,options:{},drawLegendSymbol:f.area.prototype.drawLegendSymbol,visible:!0,setState:function(){},setVisible:function(){}},t))}),i.legendItems=o;else if(l)n=l.from,r=l.to,s=l.fromLabel,l=l.toLabel,p=h?[0,0,1,0]:[0,1,0,0],h||(h=s,s=l,l=h),h={linearGradient:{x1:p[0],y1:p[1],x2:p[2],y2:p[3]},stops:[[0,n],[1,r]]},o=[{chart:i.chart,options:{},fromLabel:s,toLabel:l,color:h,drawLegendSymbol:this.drawLegendSymbolGradient,visible:!0,setState:function(){},setVisible:function(){}}],i.legendItems=o},drawLegendSymbol:f.area.prototype.drawLegendSymbol,drawLegendSymbolGradient:function(t,i){var e=t.options.symbolPadding,o=p(t.options.padding,8),a,n,r=this.chart.renderer.fontMetrics(t.options.itemStyle.fontSize).h,s=t.options.layout==="horizontal",l;l=p(t.options.rectangleLength,200);s?(a=-(e/2),n=0):(a=-l+t.baseline-e/2,n=o+r);i.fromText=this.chart.renderer.text(i.fromLabel,n,a).attr({zIndex:2}).add(i.legendGroup);n=i.fromText.getBBox();i.legendSymbol=this.chart.renderer.rect(s?n.x+n.width+e:n.x-r-e,n.y,s?l:r,s?r:l,2).attr({zIndex:1}).add(i.legendGroup);l=i.legendSymbol.getBBox();i.toText=this.chart.renderer.text(i.toLabel,l.x+l.width+e,s?a:l.y+l.height-e).attr({zIndex:2}).add(i.legendGroup);a=i.toText.getBBox();s?(t.offsetWidth=n.width+l.width+a.width+e*2+o,t.itemY=r+o):(t.offsetWidth=Math.max(n.width,a.width)+e+l.width+o,t.itemY=l.height+o,t.itemX=e)},getBox:function(t){var l=Number.MIN_VALUE,h=Number.MAX_VALUE,p=Number.MIN_VALUE,d=Number.MAX_VALUE;u(t||this.options.data,function(t){for(var i=t.path,e=i.length,o=!1,a=Number.MIN_VALUE,n=Number.MAX_VALUE,r=Number.MIN_VALUE,s=Number.MAX_VALUE;e--;)typeof i[e]==="number"&&!isNaN(i[e])&&(o?(a=Math.max(a,i[e]),n=Math.min(n,i[e])):(r=Math.max(r,i[e]),s=Math.min(s,i[e])),o=!o);t._maxX=a;t._minX=n;t._maxY=r;t._minY=s;l=Math.max(l,a);h=Math.min(h,n);p=Math.max(p,r);d=Math.min(d,s)});this.minY=d;this.maxY=p;this.minX=h;this.maxX=l},translatePath:function(t){var i=!1,e=this.xAxis,o=this.yAxis,a,t=[].concat(t);for(a=t.length;a--;)typeof t[a]==="number"&&(t[a]=i?Math.round(e.translate(t[a])):Math.round(o.len-o.translate(t[a])),i=!i);return t},setData:function(){d.Series.prototype.setData.apply(this,arguments);this.getBox()},translate:function(){var i=this,e=Number.MAX_VALUE,o=Number.MIN_VALUE;i.generatePoints();u(i.data,function(t){t.shapeType="path";t.shapeArgs={d:i.translatePath(t.path)};if(typeof t.y==="number")if(t.y>o)o=t.y;else if(t.y<e)e=t.y});i.translateColors(e,o)},translateColors:function(n,r){var s=this.options,l=s.valueRanges,h=s.colorRange,p=this.colorKey,d,m;h&&(d=x(h.from),m=x(h.to));u(this.data,function(t){var i=t[p],e,o,a;if(l)for(a=l.length;a--;){if(e=l[a],d=e.from,m=e.to,(d===void 0||i>=d)&&(m===void 0||i<=m)){o=e.color;break}}else h&&i!==void 0&&(e=1-(r-i)/(r-n),o=i===null?s.nullColor:c(d,m,e));if(o)t.color=null,t.options.color=o})},drawGraph:r,drawDataLabels:r,drawPoints:function(){var r=this.xAxis,s=this.yAxis,l=this.colorKey;u(this.data,function(t){t.plotY=1;if(t[l]===null)t[l]=0,t.isNull=!0});f.column.prototype.drawPoints.apply(this);u(this.data,function(t){var i=t.dataLabels,e=r.toPixels(t._minX,!0),o=r.toPixels(t._maxX,!0),a=s.toPixels(t._minY,!0),n=s.toPixels(t._maxY,!0);t.plotX=Math.round(e+(o-e)*p(i&&i.anchorX,.5));t.plotY=Math.round(a+(n-a)*p(i&&i.anchorY,.5));t.isNull&&(t[l]=null)});d.Series.prototype.drawDataLabels.call(this)},animateDrilldown:function(t){var i=this.chart.plotBox,e=this.chart.drilldownLevels[this.chart.drilldownLevels.length-1],o=e.bBox,a=this.chart.options.drilldown.animation;if(!t)t=Math.min(o.width/i.width,o.height/i.height),e.shapeArgs={scaleX:t,scaleY:t,translateX:o.x,translateY:o.y},u(this.points,function(t){t.graphic.attr(e.shapeArgs).animate({scaleX:1,scaleY:1,translateX:0,translateY:0},a)}),delete this.animate},animateDrillupFrom:function(t){f.column.prototype.animateDrillupFrom.call(this,t)},animateDrillupTo:function(t){f.column.prototype.animateDrillupTo.call(this,t)}});a.mapline=h(a.map,{lineWidth:1,backgroundColor:"none"});f.mapline=d.extendClass(f.map,{type:"mapline",pointAttrToOptions:{stroke:"color","stroke-width":"lineWidth",fill:"backgroundColor"},drawLegendSymbol:f.line.prototype.drawLegendSymbol});a.mappoint=h(a.scatter,{dataLabels:{enabled:!0,format:"{point.name}",color:"black",style:{textShadow:"0 0 5px white"}}});f.mappoint=d.extendClass(f.scatter,{type:"mappoint"});d.Map=function(t,i){var e={endOnTick:!1,gridLineWidth:0,labels:{enabled:!1},lineWidth:0,minPadding:0,maxPadding:0,startOnTick:!1,tickWidth:0,title:null},o;o=t.series;t.series=null;t=h({chart:{type:"map",panning:"xy"},xAxis:e,yAxis:h(e,{reversed:!0})},t,{chart:{inverted:!1}});t.series=o;return new d.Chart(t,i)}})(Highcharts);